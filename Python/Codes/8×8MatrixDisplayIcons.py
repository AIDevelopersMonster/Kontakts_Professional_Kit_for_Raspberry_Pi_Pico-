# Video https://youtu.be/_2MgAhLzeBM
# Post http://kontakts.ru/showthread.php/40884?p=86169#post86169
from machine import Pin, I2C
import time

# I2C Configuration
clock_pin = 21
data_pin = 20
bus = 0
i2c_addr_left = 0x70

# Initialize I2C
i2c = I2C(bus, sda=Pin(data_pin), scl=Pin(clock_pin))

# Set the display in matrix mode
i2c.writeto(i2c_addr_left, bytearray([0x21]))  # Turn on oscillator
time.sleep(0.1)
i2c.writeto(i2c_addr_left, bytearray([0x81]))  # Display on, blinking off
time.sleep(0.1)

# Define the eyes data
shapes = {
 'smile':[0x3c, 0x42, 0xa5, 0x81, 0xa5, 0x99, 0x42, 0x3c],
    'smileL':[0x3c, 0x42, 0xa9, 0xa9, 0x85, 0xb9, 0x42, 0x3c],
    'empty':[0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00],
    'all_on':[0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff],
    'arrow':[0x18,0x24,0x42,0xff,0x18,0x18,0x18,0x18],
    'invader1':[0x18,0x3c,0x7e,0xdb,0xff,0x24,0x5a,0xa5],
    'invader2':[0x18,0x3c,0x7e,0xdb,0xff,0x24,0x5a,0x42],
    'tree1':[0x18, 0x18, 0x3c, 0x3c, 0x7e, 0xff, 0x18, 0x18],
    'tree1lit1':[0x18, 0x18, 0x3c, 0x3c, 0x7e, 0xff, 0x18, 0x18],
    'tree1lit2':[0x5a,0x99,0x3c,0xbd,0x7e,0xff,0x18,0x18],
    'tree2':[0x18, 0x18, 0x3c, 0x3c, 0x7e, 0x7e, 0xff, 0x18],
    'bunny1':[0x66, 0x66, 0x66, 0xff, 0x81, 0xa5, 0x99, 0x7e],
    'bunny2':[0x66, 0xe7, 0x66, 0xff, 0x81, 0xa5, 0x99, 0x7e],
    'bunny3':[0x66, 0x66, 0xff, 0x81, 0xa5, 0x81, 0x99, 0x7e],
    'danbo':[0x00, 0xff, 0x81, 0xa5, 0x81, 0x81, 0xff, 0x00],
    'clock1':[0x3c, 0x42, 0x91, 0x91, 0x9d, 0x81, 0x42, 0x3c],
    'heart1F':[0x00, 0x66, 0xff, 0xff, 0x7e, 0x3c, 0x18, 0x00],
    'heart1':[0x00, 0x66, 0x99, 0x81, 0x42, 0x24, 0x18, 0x00],
    'heart2':[0x00, 0x66, 0x99, 0x81, 0x81, 0x42, 0x24, 0x18],
    'heart2F':[0x00, 0x66, 0xff, 0xff, 0xff, 0x7e, 0x3c, 0x18],
    'santaHat':[0x00, 0x3c, 0x7e, 0x4f, 0xef, 0xef, 0xef, 0x0f],
    'santaHat2':[0x00,0x00,0x3c,0x7e,0x4f,0xef,0xef,0xef],
    'star1':[0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00],
    'star2':[0x00,0x00,0x24,0x18,0x18,0x24,0x00,0x00],
    'star3':[0x00,0x42,0x24,0x18,0x18,0x24,0x42,0x00],
    'star4':[0x81,0x42,0x24,0x18,0x18,0x24,0x42,0x81],
    'star5':[0x02,0x84,0x48,0x38,0x1c,0x12,0x21,0x40],
    'star6':[0x06,0x8c,0xd8,0x7c,0x3e,0x1b,0x31,0x60],
    'star7':[0x04,0x08,0x90,0x5c,0x3a,0x09,0x10,0x20],
    'star8':[0x08,0x10,0x10,0x9e,0x79,0x08,0x08,0x10],
    'star9':[0x10,0x10,0x10,0x1f,0xf8,0x08,0x08,0x08],
    'star10':[0x20,0x10,0x11,0x1e,0x78,0x88,0x08,0x04],
    'star11':[0x40,0x21,0x12,0x1c,0x38,0x48,0x84,0x02],
     # Add more patterns here...
}

# Function to send data to the display
def send_to_display(data):
    for i in range(8):  # Loop through the 8 rows
        # Mirror the row data by reversing the bits in each byte
        mirrored_data = 0
        for j in range(8):  # Loop through each bit in the byte
            mirrored_data |= ((data[i] >> j) & 1) << (7 - j)  # Reversed bit position
        # Write the mirrored data to the appropriate register
        i2c.writeto(i2c_addr_left, bytearray([0x00 + (i << 1), mirrored_data]))  # Row data
        time.sleep(0.01)  # Small delay to ensure proper display update

# Function to show a given eye pattern
def show_eye_pattern(eye_pattern, eye_name):
    print(f"Displaying: {eye_name}")
    send_to_display(eye_pattern)

# Main loop to display various eyes
while True:
    for eye_name, eye_pattern in shapes.items():
        show_eye_pattern(eye_pattern, eye_name)  # Display eye pattern
        time.sleep(1)
